<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Packify Pro v3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --tg-bg: #f3f4f6; --tg-card: #ffffff; --tg-blue: #3b82f6; }
        body {
            background-color: var(--tg-bg);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
            height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
        }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        .tg-card {
            background-color: var(--tg-card); border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: transform 0.1s;
        }
        
        .custom-checkbox {
            appearance: none; width: 22px; height: 22px; min-width: 22px;
            border: 2px solid #cbd5e1; border-radius: 6px;
            outline: none; cursor: pointer; position: relative; transition: 0.2s;
        }
        .custom-checkbox:checked { background-color: var(--tg-blue); border-color: var(--tg-blue); }
        .custom-checkbox:checked::after {
            content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900;
            color: white; font-size: 12px;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }

        .line-through-custom { text-decoration: line-through; color: #9ca3af; }
        .sidebar-overlay { transition: opacity 0.3s ease; }
        .sidebar-content { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white px-3 py-2.5 shadow-sm z-10 flex items-center gap-3 relative">
        <button onclick="toggleSidebar()" class="text-slate-600 text-xl w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center shrink-0">
            <i class="fa-solid fa-bars"></i>
        </button>
        <div class="flex-1 relative">
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm"></i>
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm nhanh..." 
                   class="w-full bg-slate-100 text-slate-700 rounded-full py-2 pl-9 pr-4 text-sm focus:outline-none focus:ring-1 focus:ring-blue-300">
        </div>
    </header>

    <div class="bg-white border-b border-slate-200 px-3 py-2 flex justify-between items-center text-sm z-10 shadow-sm">
        <div class="flex items-center gap-2" onclick="toggleSelectAll()">
            <input type="checkbox" id="selectAllCheckbox" class="custom-checkbox h-5 w-5 !rounded">
            <span class="font-semibold text-slate-700">Ch·ªçn t·∫•t c·∫£ (<span id="selectedCount">0</span>)</span>
        </div>
        <div id="batchActions" class="hidden gap-2">
            <button onclick="batchAction('dangmua')" class="text-orange-500 bg-orange-50 px-2 py-1 rounded text-xs font-bold hover:bg-orange-100"><i class="fa-solid fa-cart-shopping"></i> Mua</button>
            <button onclick="batchAction('vali')" class="text-emerald-500 bg-emerald-50 px-2 py-1 rounded text-xs font-bold hover:bg-emerald-100"><i class="fa-solid fa-suitcase"></i> C·∫•t</button>
            <button onclick="batchAction('delete')" class="text-red-500 bg-red-50 px-2 py-1 rounded text-xs font-bold hover:bg-red-100"><i class="fa-solid fa-trash"></i></button>
        </div>
    </div>

    <div id="priceBar" class="bg-blue-50/80 text-blue-800 px-4 py-2 flex justify-between items-center text-sm font-bold border-b border-blue-100 hidden">
        <span><i class="fa-solid fa-receipt mr-1"></i> T·ªïng chi ph√≠:</span>
        <span id="totalPriceDisplay" class="text-blue-600 text-base">0 ƒë</span>
    </div>

    <main class="flex-1 overflow-y-auto p-3 pb-24" id="mainContent">
        <div id="itemList" class="flex flex-col gap-3">
            </div>
    </main>

    <button onclick="toggleAddModal()" class="fixed bottom-[72px] right-4 w-14 h-14 bg-blue-500 text-white rounded-full shadow-lg shadow-blue-500/40 flex items-center justify-center text-2xl hover:bg-blue-600 active:scale-95 transition-all z-20">
        <i class="fa-solid fa-plus"></i>
    </button>

    <nav class="bg-white border-t border-slate-200 flex justify-around items-center h-[56px] pb-[env(safe-area-inset-bottom)] fixed bottom-0 w-full z-10">
        <button onclick="switchTab('kho')" id="tab-kho" class="relative flex flex-col items-center justify-center w-full h-full text-blue-500">
            <div class="relative"><i class="fa-solid fa-box text-lg mb-0.5"></i><span id="badge-kho" class="absolute -top-1.5 -right-2 bg-red-500 text-white text-[9px] font-bold px-1.5 rounded-full">0</span></div>
            <span class="text-[10px] font-semibold">Kho To√†n C·∫ßu</span>
        </button>
        <button onclick="switchTab('dangmua')" id="tab-dangmua" class="relative flex flex-col items-center justify-center w-full h-full text-slate-400">
            <div class="relative"><i class="fa-solid fa-cart-shopping text-lg mb-0.5"></i><span id="badge-dangmua" class="absolute -top-1.5 -right-2 bg-orange-500 text-white text-[9px] font-bold px-1.5 rounded-full">0</span></div>
            <span class="text-[10px] font-semibold">ƒêang Mua</span>
        </button>
        <button onclick="switchTab('vali')" id="tab-vali" class="relative flex flex-col items-center justify-center w-full h-full text-slate-400">
            <div class="relative"><i class="fa-solid fa-suitcase-rolling text-lg mb-0.5"></i><span id="badge-vali" class="absolute -top-1.5 -right-2 bg-emerald-500 text-white text-[9px] font-bold px-1.5 rounded-full">0</span></div>
            <span class="text-[10px] font-semibold">Vali C·ªßa T√¥i</span>
        </button>
    </nav>

    <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-50 hidden sidebar-overlay" onclick="toggleSidebar()">
        <div id="sidebarContent" class="w-[75%] max-w-[280px] bg-white h-full transform -translate-x-full sidebar-content flex flex-col" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-slate-100 flex items-center gap-2">
                <i class="fa-solid fa-tags text-blue-500 text-xl"></i>
                <h2 class="text-xl font-bold text-slate-800">Danh M·ª•c</h2>
            </div>
            <div class="flex-1 overflow-y-auto p-3 flex flex-col gap-1.5" id="sidebarTagList">
                </div>
        </div>
    </div>

    <div id="addModal" class="fixed inset-0 bg-black/50 z-50 hidden flex justify-center items-center px-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-xl" id="modalContent">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">Th√™m ƒë·ªì m·ªõi</h3>
                <button onclick="toggleAddModal()" class="text-slate-400 hover:text-red-500 text-xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <input type="text" id="itemName" placeholder="T√™n m√≥n ƒë·ªì..." class="w-full bg-slate-100 rounded-xl p-3 mb-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
            <div class="flex gap-2 mb-4">
                <input type="number" id="itemQty" placeholder="SL" value="1" class="w-1/4 bg-slate-100 rounded-xl p-3 text-center text-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
                <div class="relative w-3/4">
                    <input type="text" id="itemPrice" placeholder="Gi√° ti·ªÅn (T√πy ch·ªçn)" oninput="formatPriceInput(event)" class="w-full bg-slate-100 rounded-xl p-3 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 text-right">
                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 font-bold">ƒë</span>
                </div>
            </div>
            <button onclick="addItem()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl hover:bg-blue-600 active:scale-95 transition-transform">
                Th√™m v√†o kho
            </button>
        </div>
    </div>

    <script>
        let items = [
            { id: 1, name: "App Alipay & WeChat", qty: 1, price: 0, category: "Digital", tags: ["T√†i ch√≠nh"], aviation: "X√°ch tay", note: "X√°c minh h·ªô chi·∫øu v√† li√™n k·∫øt th·∫ª Visa tr∆∞·ªõc khi bay.", status: "vali", warning: "B·∫Øt bu·ªôc ph·∫£i setup t·∫°i VN, sang TQ ch·∫∑n m·∫°ng r·∫•t kh√≥ l√†m.", checked: false },
            { id: 2, name: "Balo ch·ªëng n∆∞·ªõc", qty: 1, price: 156000, category: "H√†nh l√Ω", tags: ["Chung"], aviation: "X√°ch tay", note: "ƒê·ªÉ mang lap v√† gi·∫•y t·ªù quan tr·ªçng.", status: "kho", warning: "", checked: false }
        ];
        let currentTab = 'kho';
        let currentFilterTag = '';

        // T·ª™ ƒêI·ªÇN TH√îNG MINH SI√äU C·∫§P (Ph√¢n lo·∫°i c·ª±c chu·∫©n)
        const autoDict = [
            { keywords: ["h·ªô chi·∫øu", "visa", "jw202", "dq", "gi·∫•y t·ªù", "cƒÉn c∆∞·ªõc", "·∫£nh th·∫ª", "h·ªì s∆°", "admission"], category: "Gi·∫•y t·ªù", aviation: "B·∫Øt Bu·ªôc X√°ch Tay", note: "B·ªè v√†o t√∫i ƒëeo ch√©o tr∆∞·ªõc ng·ª±c, tuy·ªát ƒë·ªëi kh√¥ng r·ªùi ng∆∞·ªùi.", warning: "QUAN TR·ªåNG: M·∫•t l√† kh·ªèi nh·∫≠p h·ªçc. C·∫§M K√ù G·ª¨I!" },
            { keywords: ["s·∫°c d·ª± ph√≤ng", "pin", "laptop", "ipad", "ƒëi·ªán tho·∫°i", "tai nghe", "c√°p", "c·ªß s·∫°c"], category: "ƒêi·ªán t·ª≠", aviation: "B·∫Øt Bu·ªôc X√°ch Tay", note: "ƒê·∫£m b·∫£o s·∫°c d·ª± ph√≤ng c√≥ ghi r√µ dung l∆∞·ª£ng (mAh).", warning: "C·∫§M K√ù G·ª¨I s·∫°c d·ª± ph√≤ng v√† thi·∫øt b·ªã c√≥ pin. S·∫Ω b·ªã h·∫£i quan thu gi·ªØ!" },
            { keywords: ["n∆∞·ªõc hoa", "s·ªØa t·∫Øm", "d·∫ßu g·ªôi", "n∆∞·ªõc t·∫©y trang", "kem ch·ªëng n·∫Øng", "ch·∫•t l·ªèng", "skincare", "kem ƒë√°nh rƒÉng"], category: "M·ªπ ph·∫©m", aviation: "K√Ω G·ª≠i", note: "B·ªçc nilong th·∫≠t ch·∫∑t tr√°nh tr√†n khi √°p su·∫•t m√°y bay thay ƒë·ªïi.", warning: "Chai l·ªç > 100ml B·∫ÆT BU·ªòC K√ù G·ª¨I. X√°ch tay s·∫Ω b·ªã v·ª©t b·ªè t·∫°i s√¢n bay." },
            { keywords: ["dao", "k√©o", "dao c·∫°o", "c·∫Øt m√≥ng tay", "v·∫≠t nh·ªçn", "tu·ªëc n∆° v√≠t"], category: "D·ª•ng c·ª•", aviation: "K√Ω G·ª≠i", note: "G√≥i c·∫©n th·∫≠n v√†o gi·ªØa vali k√Ω g·ª≠i.", warning: "C·∫§M X√ÅCH TAY v·∫≠t s·∫Øc nh·ªçn." },
            { keywords: ["m·ª≥ t√¥m", "m√¨ t√¥m", "ph·ªü g√≥i", "h·∫£o h·∫£o", "b√∫n", "mi·∫øn"], category: "Th·ª±c ph·∫©m", aviation: "K√Ω g·ª≠i / X√°ch tay", note: "N√™n mang lo·∫°i v·ªã h·∫£i s·∫£n ho·∫∑c chay.", warning: "Tr√°nh tuy·ªát ƒë·ªëi m·ª≥ c√≥ ch·ªØ/h√¨nh TH·ªäT HEO, TH·ªäT B√í. H·∫£i quan soi th·∫•y s·∫Ω t·ªãch thu." },
            { keywords: ["th·ªãt heo", "x√∫c x√≠ch", "ru·ªëc", "ch√† b√¥ng", "th·ªãt b√≤", "kh√¥ g√†", "tr√°i c√¢y t∆∞∆°i"], category: "Th·ª±c ph·∫©m", aviation: "C·∫•m", note: "Kh√¥ng n√™n mang theo k·∫ªo r∆∞·ªõc h·ªça v√†o th√¢n.", warning: "H·∫¢I QUAN TRUNG QU·ªêC C·∫§M NH·∫¨P C·∫¢NH TH·ªäT ƒê·ªòNG V·∫¨T. Ph·∫°t ti·ªÅn r·∫•t n·∫∑ng!" },
            { keywords: ["thu·ªëc", "ƒëau b·ª•ng", "c·∫£m", "kh√°ng sinh", "bƒÉng g·∫°c", "d·∫° d√†y", "ti√™u h√≥a", "berberin"], category: "Y t·∫ø", aviation: "K√Ω G·ª≠i", note: "Chia ra t√∫i zip nh·ªè, ch·ª•p l·∫°i v·ªè thu·ªëc.", warning: "" },
            { keywords: ["qu·∫ßn", "√°o", "t·∫•t", "gi√†y", "v√°y", "ƒë·ªì l√≥t", "√°o kho√°c", "len", "n√≥n"], category: "Trang ph·ª•c", aviation: "K√Ω G·ª≠i", note: "Cu·ªôn tr√≤n ƒë·ªì ho·∫∑c d√πng t√∫i h√∫t ch√¢n kh√¥ng ƒë·ªÉ ti·∫øt ki·ªám di·ªán t√≠ch.", warning: "" },
            { keywords: ["balo", "vali", "t√∫i x√°ch", "v√≠"], category: "H√†nh l√Ω", aviation: "X√°ch tay / K√Ω g·ª≠i", note: "G·∫Øn nametag ghi r√µ T√™n v√† SDT l√™n vali.", warning: "" },
            { keywords: ["ti·ªÅn", "nh√¢n d√¢n t·ªá", "usd", "th·∫ª visa", "mastercard"], category: "T√†i ch√≠nh", aviation: "X√°ch Tay", note: "ƒê·ªïi tr∆∞·ªõc m·ªôt √≠t NDT l·∫ª ƒë·ªÉ ƒëi t√†u/xe.", warning: "Kh√¥ng mang qu√° 5000 USD ti·ªÅn m·∫∑t khi xu·∫•t c·∫£nh VN." },
            { keywords: ["tampermonkey", "code", "vpn", "clash", "v2ray", "wechat", "alipay"], category: "Digital", aviation: "C√†i ƒê·∫∑t", note: "Setup v√† test k·ªπ k·∫øt n·ªëi VPN tr∆∞·ªõc khi bay.", warning: "Sang TQ kh√¥ng c√≥ VPN l√† m·∫•t m·∫°ng qu·ªëc t·∫ø, kh√¥ng v√†o ƒë∆∞·ª£c FB/Google." }
        ];

        function autoCategorize(name) {
            let lowerName = name.toLowerCase();
            for (let dict of autoDict) {
                if (dict.keywords.some(kw => lowerName.includes(kw))) {
                    return { category: dict.category, tags: ["C√° nh√¢n"], aviation: dict.aviation, note: dict.note, warning: dict.warning };
                }
            }
            return { category: "ƒê·ªì d√πng", tags: ["Chung"], aviation: "Ch∆∞a r√µ", note: "Ki·ªÉm tra l·∫°i xem n√™n x√°ch tay hay k√Ω g·ª≠i.", warning: "" };
        }

        // ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatMoney(amount) {
            return new Intl.NumberFormat('en-US').format(amount);
        }

        function formatPriceInput(e) {
            let val = e.target.value.replace(/\D/g, '');
            e.target.value = val ? Number(val).toLocaleString('en-US') : '';
        }

        // Chuy·ªÉn Tab
        function switchTab(tab) {
            currentTab = tab;
            ['kho', 'dangmua', 'vali'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.replace(t === tab ? 'text-slate-400' : 'text-blue-500', t === tab ? 'text-blue-500' : 'text-slate-400');
            });
            document.getElementById('priceBar').style.display = (tab === 'dangmua' || tab === 'vali') ? 'flex' : 'none';
            document.getElementById('selectAllCheckbox').checked = false;
            items.forEach(i => i.checked = false); // Reset tick khi chuy·ªÉn tab
            renderItems();
        }

        // Checkbox Logic & C·∫£nh b√°o ƒë·ªè
        function toggleCheckbox(id) {
            let item = items.find(i => i.id === id);
            if (item) {
                item.checked = !item.checked;
                
                // N·∫æU V·ª™A TICK M√Ä C√ì C·∫¢NH B√ÅO -> B√ÅO ƒê·ªé L√äN
                if (item.checked && item.warning) {
                    alert("üö® C·∫¢NH B√ÅO H√ÄNG KH√îNG/H·∫¢I QUAN:\n\n" + item.warning);
                }
            }
            renderItems();
        }

        function toggleSelectAll() {
            let isChecked = document.getElementById('selectAllCheckbox').checked;
            items.filter(i => i.status === currentTab).forEach(i => i.checked = isChecked);
            renderItems();
        }

        function batchAction(action) {
            let selected = items.filter(i => i.status === currentTab && i.checked);
            if (selected.length === 0) return;
            
            if(action === 'delete') {
                if(!confirm(`X√≥a ${selected.length} m√≥n ƒë·ªì n√†y vƒ©nh vi·ªÖn?`)) return;
                items = items.filter(i => !(i.status === currentTab && i.checked));
            } else {
                selected.forEach(i => { i.status = action; i.checked = false; });
            }
            document.getElementById('selectAllCheckbox').checked = false;
            renderItems();
        }

        // Render Giao Di·ªán
        function renderItems(searchText = "") {
            const listEl = document.getElementById('itemList');
            listEl.innerHTML = '';
            
            let filteredItems = items.filter(i => i.status === currentTab);
            if(searchText) filteredItems = filteredItems.filter(i => i.name.toLowerCase().includes(searchText.toLowerCase()));
            if(currentFilterTag) filteredItems = filteredItems.filter(i => i.category === currentFilterTag || i.tags.includes(currentFilterTag));

            // T√≠nh to√°n Badges & Ti·ªÅn
            document.getElementById('badge-kho').innerText = items.filter(i => i.status === 'kho').length;
            document.getElementById('badge-dangmua').innerText = items.filter(i => i.status === 'dangmua').length;
            document.getElementById('badge-vali').innerText = items.filter(i => i.status === 'vali').length;

            let totalPrice = filteredItems.reduce((sum, item) => sum + (Number(item.price) * item.qty), 0);
            document.getElementById('totalPriceDisplay').innerText = `${formatMoney(totalPrice)} ƒë`;

            let checkedCount = filteredItems.filter(i => i.checked).length;
            document.getElementById('selectedCount').innerText = checkedCount;
            
            // Hi·ªán/·∫®n n√∫t Batch Actions
            if(checkedCount > 0) {
                document.getElementById('batchActions').classList.replace('hidden', 'flex');
            } else {
                document.getElementById('batchActions').classList.replace('flex', 'hidden');
            }

            filteredItems.forEach(item => {
                let textClass = (item.checked && currentTab === 'vali') ? 'line-through-custom' : 'text-slate-800';
                let warningHtml = item.warning ? `<div class="mt-2 text-[11px] text-red-600 bg-red-50 p-2 rounded-lg font-medium leading-snug"><i class="fa-solid fa-triangle-exclamation mr-1"></i>${item.warning}</div>` : '';

                // M√†u s·∫Øc Tag h√†ng kh√¥ng
                let aviaColor = "bg-slate-100 text-slate-600";
                if(item.aviation.includes("X√°ch Tay") || item.aviation.includes("X√°ch tay")) aviaColor = "bg-blue-100 text-blue-700";
                if(item.aviation.includes("K√Ω G·ª≠i") || item.aviation.includes("K√Ω g·ª≠i")) aviaColor = "bg-emerald-100 text-emerald-700";
                if(item.aviation.includes("C·∫•m")) aviaColor = "bg-red-100 text-red-700";

                // N√∫t thao t√°c (Kh√¥ng b·ªã tr∆∞·ª£t ra ngo√†i n·ªØa)
                let actionBtns = '';
                if (currentTab === 'kho') {
                    actionBtns = `
                        <button onclick="changeStatus(${item.id}, 'dangmua')" class="w-8 h-8 flex items-center justify-center rounded-full bg-orange-50 text-orange-500 hover:bg-orange-100"><i class="fa-solid fa-cart-shopping"></i></button>
                        <button onclick="changeStatus(${item.id}, 'vali')" class="w-8 h-8 flex items-center justify-center rounded-full bg-emerald-50 text-emerald-600 hover:bg-emerald-100"><i class="fa-solid fa-suitcase"></i></button>
                    `;
                } else if (currentTab === 'dangmua') {
                    actionBtns = `
                        <button onclick="changeStatus(${item.id}, 'kho')" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500"><i class="fa-solid fa-rotate-left"></i></button>
                        <button onclick="changeStatus(${item.id}, 'vali')" class="w-8 h-8 flex items-center justify-center rounded-full bg-emerald-50 text-emerald-600"><i class="fa-solid fa-suitcase"></i></button>
                    `;
                } else {
                    actionBtns = `
                        <button onclick="changeStatus(${item.id}, 'kho')" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500"><i class="fa-solid fa-box-open"></i></button>
                    `;
                }

                listEl.innerHTML += `
                    <div class="tg-card p-3 flex gap-3">
                        <div class="pt-1"><input type="checkbox" class="custom-checkbox" onchange="toggleCheckbox(${item.id})" ${item.checked ? 'checked' : ''}></div>
                        
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start gap-1.5">
                                <h3 class="font-bold text-[15px] leading-tight ${textClass} break-words">${item.name}</h3>
                                <span class="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold shrink-0 mt-0.5">x${item.qty}</span>
                            </div>
                            ${item.price > 0 ? `<div class="text-[12px] font-bold text-blue-600 mt-0.5">${formatMoney(item.price)} ƒë</div>` : ''}
                            
                            ${item.note ? `<p class="text-[12px] text-slate-500 mt-1 leading-snug italic">${item.note}</p>` : ''}
                            
                            <div class="flex flex-wrap gap-1.5 mt-2">
                                <span class="text-[9px] uppercase font-bold px-1.5 py-0.5 rounded border border-slate-200 text-slate-600">${item.category}</span>
                            </div>

                            <div class="border-t border-dashed border-slate-200 my-2"></div>

                            <div class="flex items-center gap-1">
                                <i class="fa-solid fa-plane-departure text-[10px] text-slate-400"></i>
                                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded ${aviaColor}">${item.aviation}</span>
                            </div>

                            ${warningHtml}
                        </div>

                        <div class="flex flex-col gap-2 justify-center pl-2 border-l border-slate-100 shrink-0">
                            ${actionBtns}
                            <button onclick="deleteItem(${item.id})" class="w-8 h-8 flex items-center justify-center rounded-full text-slate-300 hover:text-red-500 hover:bg-red-50"><i class="fa-solid fa-xmark"></i></button>
                        </div>
                    </div>
                `;
            });
            updateSidebarTags();
        }

        // Add Logic
        function addItem() {
            let name = document.getElementById('itemName').value.trim();
            let qty = document.getElementById('itemQty').value || 1;
            let priceStr = document.getElementById('itemPrice').value.replace(/,/g, ''); // B·ªè d·∫•u ph·∫©y ƒë·ªÉ t√≠nh to√°n
            let price = priceStr ? Number(priceStr) : 0;
            
            if(!name) return;

            let autoData = autoCategorize(name);

            items.unshift({
                id: Date.now(),
                name: name,
                qty: Number(qty),
                price: price,
                category: autoData.category,
                tags: autoData.tags,
                aviation: autoData.aviation,
                note: autoData.note,
                status: 'kho',
                warning: autoData.warning,
                checked: false
            });

            document.getElementById('itemName').value = '';
            document.getElementById('itemPrice').value = '';
            toggleAddModal();
            switchTab('kho');
        }

        function changeStatus(id, newStatus) {
            let item = items.find(i => i.id === id);
            if(item) { item.status = newStatus; item.checked = false; renderItems(); }
        }

        function deleteItem(id) {
            if(confirm("X√≥a m√≥n n√†y kh·ªèi h·ªá th·ªëng?")) {
                items = items.filter(i => i.id !== id);
                renderItems();
            }
        }

        // Sidebar Update (B·ªè d·∫•u #)
        function updateSidebarTags() {
            const listEl = document.getElementById('sidebarTagList');
            let allCategories = new Set(items.map(i => i.category));
            
            listEl.innerHTML = `<button onclick="filterByTag('')" class="text-left px-3 py-2.5 rounded-lg ${currentFilterTag === '' ? 'bg-blue-50 text-blue-600 font-bold' : 'bg-slate-50 text-slate-700 font-medium'} text-sm">T·∫•t c·∫£ danh m·ª•c</button>`;
            
            [...allCategories].sort().forEach(tag => {
                let activeClass = currentFilterTag === tag ? 'bg-blue-50 text-blue-600 font-bold' : 'text-slate-600 hover:bg-slate-50';
                listEl.innerHTML += `<button onclick="filterByTag('${tag}')" class="text-left px-3 py-2.5 rounded-lg text-sm font-medium ${activeClass}">${tag}</button>`;
            });
        }

        function filterByTag(tag) { currentFilterTag = tag; toggleSidebar(); renderItems(); }

        // Toggles
        const modal = document.getElementById('addModal');
        function toggleAddModal() { modal.classList.toggle('hidden'); }
        
        const sidebar = document.getElementById('sidebarOverlay');
        const sidebarContent = document.getElementById('sidebarContent');
        function toggleSidebar() {
            if(sidebar.classList.contains('hidden')) {
                sidebar.classList.remove('hidden');
                setTimeout(() => sidebarContent.classList.remove('-translate-x-full'), 10);
            } else {
                sidebarContent.classList.add('-translate-x-full');
                setTimeout(() => sidebar.classList.add('hidden'), 300);
            }
        }

        document.getElementById('searchInput').addEventListener('input', (e) => renderItems(e.target.value));
        renderItems();
    </script>
</body>
</html>
