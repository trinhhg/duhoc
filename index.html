<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Packify Pro v5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --tg-bg: #f3f4f6; --tg-card: #ffffff; --tg-blue: #3b82f6; }
        body {
            background-color: var(--tg-bg); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent; height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
        }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .tg-card { background-color: var(--tg-card); border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .custom-checkbox {
            appearance: none; width: 22px; height: 22px; min-width: 22px;
            border: 2px solid #cbd5e1; border-radius: 6px; outline: none; cursor: pointer; position: relative; transition: 0.2s;
        }
        .custom-checkbox:checked { background-color: var(--tg-blue); border-color: var(--tg-blue); }
        .custom-checkbox:checked::after {
            content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900;
            color: white; font-size: 12px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .line-through-custom { text-decoration: line-through; color: #9ca3af; }
        .sidebar-content { transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* ·∫®n m≈©i t√™n m·∫∑c ƒë·ªãnh c·ªßa input number */
        input[type="number"]::-webkit-inner-spin-button, 
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white px-3 py-2.5 shadow-sm z-10 flex items-center gap-3 relative">
        <button onclick="toggleSidebar()" class="text-slate-600 text-xl w-10 h-10 rounded-full hover:bg-slate-100 flex items-center justify-center shrink-0">
            <i class="fa-solid fa-bars"></i>
        </button>
        <div class="flex-1 relative">
            <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 text-sm"></i>
            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm nhanh..." 
                   class="w-full bg-slate-100 text-slate-700 rounded-full py-2 pl-9 pr-4 text-sm focus:outline-none focus:ring-1 focus:ring-blue-300">
        </div>
    </header>

    <div class="bg-white border-b border-slate-200 px-3 py-2 flex justify-between items-center text-sm z-10 shadow-sm">
        <div class="flex items-center gap-2" onclick="toggleSelectAll()">
            <input type="checkbox" id="selectAllCheckbox" class="custom-checkbox h-5 w-5 !rounded">
            <span class="font-semibold text-slate-700">Ch·ªçn t·∫•t c·∫£ (<span id="selectedCount">0</span>)</span>
        </div>
        <div id="batchActions" class="hidden gap-2">
            <button onclick="batchAction('dangmua')" class="text-orange-500 bg-orange-50 px-2 py-1 rounded text-xs font-bold hover:bg-orange-100"><i class="fa-solid fa-cart-shopping"></i> Mua</button>
            <button onclick="batchAction('vali')" class="text-emerald-500 bg-emerald-50 px-2 py-1 rounded text-xs font-bold hover:bg-emerald-100"><i class="fa-solid fa-suitcase"></i> C·∫•t</button>
            <button onclick="batchAction('delete')" class="text-red-500 bg-red-50 px-2 py-1 rounded text-xs font-bold hover:bg-red-100"><i class="fa-solid fa-trash"></i></button>
        </div>
    </div>

    <div id="priceBar" class="bg-blue-50/80 text-blue-800 px-4 py-2 flex justify-between items-center text-sm font-bold border-b border-blue-100 hidden">
        <span><i class="fa-solid fa-receipt mr-1"></i> T·ªïng chi ph√≠:</span>
        <span id="totalPriceDisplay" class="text-blue-600 text-base">0 ƒë</span>
    </div>

    <main class="flex-1 overflow-y-auto p-3 pb-24" id="mainContent">
        <div id="itemList" class="flex flex-col gap-3"></div>
    </main>

    <button onclick="openAddModal()" class="fixed bottom-[72px] right-4 w-14 h-14 bg-blue-500 text-white rounded-full shadow-lg shadow-blue-500/40 flex items-center justify-center text-2xl hover:bg-blue-600 active:scale-95 transition-all z-20">
        <i class="fa-solid fa-plus"></i>
    </button>

    <nav class="bg-white border-t border-slate-200 flex justify-around items-center h-[56px] pb-[env(safe-area-inset-bottom)] fixed bottom-0 w-full z-10">
        <button onclick="switchTab('kho')" id="tab-kho" class="relative flex flex-col items-center justify-center w-full h-full text-blue-500">
            <div class="relative"><i class="fa-solid fa-box text-lg mb-0.5"></i><span id="badge-kho" class="absolute -top-1.5 -right-2 bg-red-500 text-white text-[9px] font-bold px-1.5 rounded-full shadow-sm">0</span></div>
            <span class="text-[10px] font-semibold">Kho To√†n C·∫ßu</span>
        </button>
        <button onclick="switchTab('dangmua')" id="tab-dangmua" class="relative flex flex-col items-center justify-center w-full h-full text-slate-400">
            <div class="relative"><i class="fa-solid fa-cart-shopping text-lg mb-0.5"></i><span id="badge-dangmua" class="absolute -top-1.5 -right-2 bg-orange-500 text-white text-[9px] font-bold px-1.5 rounded-full shadow-sm">0</span></div>
            <span class="text-[10px] font-semibold">ƒêang Mua</span>
        </button>
        <button onclick="switchTab('vali')" id="tab-vali" class="relative flex flex-col items-center justify-center w-full h-full text-slate-400">
            <div class="relative"><i class="fa-solid fa-suitcase-rolling text-lg mb-0.5"></i><span id="badge-vali" class="absolute -top-1.5 -right-2 bg-emerald-500 text-white text-[9px] font-bold px-1.5 rounded-full shadow-sm">0</span></div>
            <span class="text-[10px] font-semibold">Vali C·ªßa T√¥i</span>
        </button>
    </nav>

    <div id="sidebarOverlay" class="fixed inset-0 bg-black/50 z-50 hidden" onclick="toggleSidebar()">
        <div id="sidebarContent" class="w-[75%] max-w-[280px] bg-white h-full transform -translate-x-full sidebar-content flex flex-col" onclick="event.stopPropagation()">
            <div class="p-4 border-b border-slate-100 flex items-center gap-2">
                <i class="fa-solid fa-tags text-blue-500 text-xl"></i><h2 class="text-xl font-bold text-slate-800">Danh M·ª•c Lazada</h2>
            </div>
            <div class="flex-1 overflow-y-auto p-3 flex flex-col gap-1.5" id="sidebarTagList"></div>
        </div>
    </div>

    <div id="addModal" class="fixed inset-0 bg-black/50 z-50 hidden flex justify-center items-center px-4">
        <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-xl" id="modalContent">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="modalTitle">Th√™m ƒë·ªì m·ªõi</h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 text-xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <input type="text" id="itemName" placeholder="T√™n m√≥n ƒë·ªì..." class="w-full bg-slate-100 rounded-xl p-3 mb-3 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 font-medium">
            
            <div class="flex gap-2 mb-4">
                <div class="flex items-center justify-between bg-slate-100 rounded-xl px-1 w-[110px] shrink-0 border border-slate-200">
                    <button type="button" onclick="adjustQty(-1)" class="w-8 h-10 text-slate-500 font-bold text-xl active:text-blue-500">-</button>
                    <input type="number" id="itemQty" value="1" class="w-8 text-center bg-transparent focus:outline-none text-sm font-bold p-0" readonly>
                    <button type="button" onclick="adjustQty(1)" class="w-8 h-10 text-slate-500 font-bold text-lg active:text-blue-500">+</button>
                </div>
                
                <div class="relative flex-1">
                    <input type="text" id="itemPrice" placeholder="Gi√° 1 m√≥n (T√πy ch·ªçn)" oninput="formatPriceInput(event)" class="w-full bg-slate-100 rounded-xl p-3 pr-8 text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 text-right font-bold border border-slate-200">
                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 font-bold text-sm">ƒë</span>
                </div>
            </div>
            
            <button id="submitBtn" onclick="saveItem()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl hover:bg-blue-600 active:scale-95 transition-transform">
                Th√™m v√†o kho
            </button>
        </div>
    </div>

    <script>
        // LOAD D·ªÆ LI·ªÜU T·ª™ LOCAL STORAGE HO·∫∂C D√ôNG M·∫∂C ƒê·ªäNH
        let items = JSON.parse(localStorage.getItem('packify_data')) || [
            { id: 1, name: "Visa X2 & JW202", qty: 1, price: 0, category: "D√†nh ri√™ng cho b·∫°n", aviation: "B·∫Øt Bu·ªôc X√°ch Tay", note: "B·ªè t√∫i ƒëeo ch√©o tr∆∞·ªõc ng·ª±c, tuy·ªát ƒë·ªëi kh√¥ng c·∫•t s√¢u.", status: "vali", warning: "M·∫•t l√† kh√¥ng th·ªÉ nh·∫≠p c·∫£nh Trung Qu·ªëc!", checked: false },
            { id: 2, name: "S·∫°c d·ª± ph√≤ng", qty: 1, price: 350000, category: "Ph·ª• Ki·ªán ƒêi·ªán T·ª≠", aviation: "X√°ch tay", note: "N√™n mang lo·∫°i 10000 - 20000mAh.", status: "kho", warning: "Tuy·ªát ƒë·ªëi KH√îNG K√ù G·ª¨I s·∫°c d·ª± ph√≤ng.", checked: false }
        ];
        
        // H√ÄM L∆ØU V√ÄO TR√åNH DUY·ªÜT (F5 KH√îNG M·∫§T)
        function saveToStorage() {
            localStorage.setItem('packify_data', JSON.stringify(items));
        }

        let currentTab = 'kho';
        let currentFilterTag = '';
        let editingId = null;

        // T·ª™ ƒêI·ªÇN ƒê√É FIX L·ªñI "KHƒÇN" & "D√âP"
        const autoDict = [
            { keywords: ["h·ªô chi·∫øu", "visa", "jw202", "dq", "gi·∫•y b√°o", "ti·ªÅn", "th·∫ª visa", "alipay", "wechat", "cƒÉn c∆∞·ªõc", "·∫£nh th·∫ª"], category: "D√†nh ri√™ng cho b·∫°n", aviation: "B·∫Øt Bu·ªôc X√°ch Tay", note: "Lu√¥n mang theo ng∆∞·ªùi.", warning: "C·ª∞C K·ª≤ QUAN TR·ªåNG: Tuy·ªát ƒë·ªëi kh√¥ng ƒë·ªÉ trong vali k√Ω g·ª≠i!" },
            { keywords: ["laptop", "ƒëi·ªán tho·∫°i", "ipad", "m√°y ·∫£nh"], category: "Thi·∫øt B·ªã ƒêi·ªán T·ª≠", aviation: "B·∫Øt Bu·ªôc X√°ch Tay", note: "S·∫°c ƒë·∫ßy pin tr∆∞·ªõc khi bay.", warning: "C·∫•m k√Ω g·ª≠i thi·∫øt b·ªã c√≥ pin dung l∆∞·ª£ng l·ªõn." },
            { keywords: ["s·∫°c d·ª± ph√≤ng", "pin", "tai nghe", "c√°p", "c·ªß s·∫°c", "chu·ªôt", "vpn", "tampermonkey"], category: "Ph·ª• Ki·ªán ƒêi·ªán T·ª≠", aviation: "X√°ch tay (Pin) - K√Ω g·ª≠i (D√¢y)", note: "S·∫°c d·ª± ph√≤ng c·∫ßm tay.", warning: "H√†ng kh√¥ng TQ C·∫§M K√ù G·ª¨I s·∫°c d·ª± ph√≤ng." },
            { keywords: ["n∆∞·ªõc hoa", "s·ªØa t·∫Øm", "d·∫ßu g·ªôi", "t·∫©y trang", "kem ch·ªëng n·∫Øng", "m·ªπ ph·∫©m", "kem ƒë√°nh rƒÉng", "thu·ªëc", "ƒëau b·ª•ng", "c·∫£m", "bƒÉng g·∫°c", "d·∫° d√†y"], category: "S·ª©c Kh·ªèe & L√†m ƒê·∫πp", aviation: "K√Ω G·ª≠i", note: "B·ªçc k√≠n t√∫i zip tr√°nh tr√†n.", warning: "CH·∫§T L·ªéNG > 100ml B·∫ÆT BU·ªòC K√ù G·ª¨I." },
            { keywords: ["m·ª≥ t√¥m", "ph·ªü", "h·∫£o h·∫£o", "b√∫n", "b√°nh k·∫πo", "cafe", "tr√†"], category: "Si√™u Th·ªã T·∫°p H√≥a", aviation: "K√Ω G·ª≠i", note: "N√™n mang v·ªã h·∫£i s·∫£n/chay.", warning: "Tr√°nh tuy·ªát ƒë·ªëi m·ª≥ c√≥ ch·ªØ/h√¨nh TH·ªäT HEO, TH·ªäT B√í." },
            { keywords: ["th·ªãt heo", "x√∫c x√≠ch", "ru·ªëc", "ch√† b√¥ng", "th·ªãt b√≤", "kh√¥ g√†", "tr√°i c√¢y", "h·∫°t gi·ªëng"], category: "Si√™u Th·ªã T·∫°p H√≥a", aviation: "C·∫§M NH·∫¨P C·∫¢NH", note: "Kh√¥ng mang theo.", warning: "H·∫¢I QUAN TRUNG QU·ªêC C·∫§M T·∫†I C·ª¨A KH·∫®U! Ph·∫°t ti·ªÅn r·∫•t n·∫∑ng." },
            // V·∫¨T S·∫ÆC NH·ªåN ƒê√É ƒê∆Ø·ª¢C T√ÅCH RI√äNG
            { keywords: ["dao", "k√©o", "dao c·∫°o", "c·∫Øt m√≥ng tay", "tu·ªëc n∆° v√≠t", "kim", "nh·ªçn"], category: "H√†ng Gia d·ª•ng & ƒê·ªùi s·ªëng", aviation: "K√Ω G·ª≠i", note: "X·∫øp v√†o g√≥c vali k√Ω g·ª≠i.", warning: "V·∫≠t s·∫Øc nh·ªçn B·∫ÆT BU·ªòC K√ù G·ª¨I." },
            // ƒê·ªí D√ôNG B√åNH TH∆Ø·ªúNG / GI·∫§Y ∆Ø·ªöT KH√îNG B·ªä B√ÅO ƒê·ªé N·ªÆA
            { keywords: ["khƒÉn", "gi·∫•y ∆∞·ªõt", "b√†n ch·∫£i", "c·ªëc", "bƒÉng d√≠nh", "bƒÉng v·ªá sinh", "m√≥c √°o", "gi·∫•y"], category: "H√†ng Gia d·ª•ng & ƒê·ªùi s·ªëng", aviation: "X√°ch tay / K√Ω g·ª≠i", note: "X·∫øp v√†o c√°c g√≥c tr·ªëng c·ªßa vali.", warning: "" },
            { keywords: ["d√©p", "gi√†y", "t·∫•t", "qu·∫ßn", "√°o", "v√°y", "ƒë·ªì l√≥t", "√°o kho√°c", "len", "n√≥n"], category: "Th·ªùi trang & Ph·ª• ki·ªán Nam", aviation: "K√Ω G·ª≠i", note: "Cu·ªôn tr√≤n ƒë·ªì ƒë·ªÉ ti·∫øt ki·ªám di·ªán t√≠ch.", warning: "" },
            { keywords: ["balo", "vali", "·ªï kh√≥a", "g·ªëi c·ªï"], category: "Th·ªÉ Thao & Du L·ªãch", aviation: "X√°ch tay / K√Ω g·ª≠i", note: "G·∫Øn nametag ghi r√µ T√™n, SƒêT.", warning: "" }
        ];

        function autoCategorize(name) {
            let lowerName = name.toLowerCase();
            for (let dict of autoDict) {
                if (dict.keywords.some(kw => lowerName.includes(kw))) {
                    return { category: dict.category, aviation: dict.aviation, note: dict.note, warning: dict.warning };
                }
            }
            return { category: "Si√™u Th·ªã T·∫°p H√≥a", aviation: "Ki·ªÉm tra l·∫°i", note: "Ch∆∞a r√µ quy ƒë·ªãnh, t·ª± t√¨m hi·ªÉu xem x√°ch tay hay k√Ω g·ª≠i.", warning: "" };
        }

        function formatMoney(amount) { return new Intl.NumberFormat('en-US').format(amount); }
        function formatPriceInput(e) {
            let val = e.target.value.replace(/\D/g, '');
            e.target.value = val ? Number(val).toLocaleString('en-US') : '';
        }

        // Logic tƒÉng/gi·∫£m s·ªë l∆∞·ª£ng
        function adjustQty(change) {
            let el = document.getElementById('itemQty');
            let newVal = parseInt(el.value) + change;
            if (newVal >= 1) el.value = newVal;
        }

        function switchTab(tab) {
            currentTab = tab;
            ['kho', 'dangmua', 'vali'].forEach(t => {
                document.getElementById(`tab-${t}`).classList.replace(t === tab ? 'text-slate-400' : 'text-blue-500', t === tab ? 'text-blue-500' : 'text-slate-400');
            });
            document.getElementById('priceBar').style.display = (tab === 'dangmua' || tab === 'vali') ? 'flex' : 'none';
            document.getElementById('selectAllCheckbox').checked = false;
            items.forEach(i => i.checked = false);
            renderItems();
        }

        function toggleCheckbox(id) {
            let item = items.find(i => i.id === id);
            if (item) {
                item.checked = !item.checked;
                if (item.checked && item.warning) alert("üö® QUY ƒê·ªäNH BAY / H·∫¢I QUAN TQ:\n\n" + item.warning);
                saveToStorage();
            }
            renderItems();
        }

        function toggleSelectAll() {
            let isChecked = document.getElementById('selectAllCheckbox').checked;
            items.filter(i => i.status === currentTab).forEach(i => i.checked = isChecked);
            renderItems();
        }

        function batchAction(action) {
            let selected = items.filter(i => i.status === currentTab && i.checked);
            if (selected.length === 0) return;
            if(action === 'delete') {
                items = items.filter(i => !(i.status === currentTab && i.checked));
            } else {
                selected.forEach(i => { i.status = action; i.checked = false; });
            }
            document.getElementById('selectAllCheckbox').checked = false;
            saveToStorage();
            renderItems();
        }

        function deleteItem(id) {
            items = items.filter(i => i.id !== id);
            saveToStorage();
            renderItems();
        }

        function changeStatus(id, newStatus) {
            let item = items.find(i => i.id === id);
            if(item) { item.status = newStatus; item.checked = false; saveToStorage(); renderItems(); }
        }

        function renderItems(searchText = "") {
            const listEl = document.getElementById('itemList');
            listEl.innerHTML = '';
            
            let filteredItems = items.filter(i => i.status === currentTab);
            if(searchText) filteredItems = filteredItems.filter(i => i.name.toLowerCase().includes(searchText.toLowerCase()));
            if(currentFilterTag) filteredItems = filteredItems.filter(i => i.category === currentFilterTag);

            document.getElementById('badge-kho').innerText = items.filter(i => i.status === 'kho').length;
            document.getElementById('badge-dangmua').innerText = items.filter(i => i.status === 'dangmua').length;
            document.getElementById('badge-vali').innerText = items.filter(i => i.status === 'vali').length;

            // T√≠nh t·ªïng ti·ªÅn (Gi√° 1 m√≥n * S·ªë l∆∞·ª£ng)
            let totalPrice = filteredItems.reduce((sum, item) => sum + (Number(item.price) * item.qty), 0);
            document.getElementById('totalPriceDisplay').innerText = `${formatMoney(totalPrice)} ƒë`;

            let checkedCount = filteredItems.filter(i => i.checked).length;
            document.getElementById('selectedCount').innerText = checkedCount;
            document.getElementById('batchActions').classList.replace(checkedCount > 0 ? 'hidden' : 'flex', checkedCount > 0 ? 'flex' : 'hidden');

            filteredItems.forEach(item => {
                let textClass = (item.checked && currentTab === 'vali') ? 'line-through-custom' : 'text-slate-800';
                let warningHtml = item.warning ? `<div class="mt-2 text-[11px] text-red-600 bg-red-50 p-2 rounded-lg font-medium leading-snug"><i class="fa-solid fa-triangle-exclamation mr-1"></i>${item.warning}</div>` : '';

                let aviaColor = "bg-slate-100 text-slate-600";
                if(item.aviation.includes("X√°ch Tay") || item.aviation.includes("X√°ch tay")) aviaColor = "bg-blue-100 text-blue-700";
                if(item.aviation.includes("K√Ω G·ª≠i") || item.aviation.includes("K√Ω g·ª≠i")) aviaColor = "bg-emerald-100 text-emerald-700";
                if(item.aviation.includes("C·∫§M")) aviaColor = "bg-red-100 text-red-700";

                let actionBtns = '';
                if (currentTab === 'kho') {
                    actionBtns = `
                        <button onclick="changeStatus(${item.id}, 'dangmua')" class="w-8 h-8 flex items-center justify-center rounded-full bg-orange-50 text-orange-500 hover:bg-orange-100"><i class="fa-solid fa-cart-shopping text-sm"></i></button>
                        <button onclick="changeStatus(${item.id}, 'vali')" class="w-8 h-8 flex items-center justify-center rounded-full bg-emerald-50 text-emerald-600 hover:bg-emerald-100"><i class="fa-solid fa-suitcase text-sm"></i></button>
                    `;
                } else if (currentTab === 'dangmua') {
                    actionBtns = `
                        <button onclick="changeStatus(${item.id}, 'kho')" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500"><i class="fa-solid fa-rotate-left text-sm"></i></button>
                        <button onclick="changeStatus(${item.id}, 'vali')" class="w-8 h-8 flex items-center justify-center rounded-full bg-emerald-50 text-emerald-600"><i class="fa-solid fa-suitcase text-sm"></i></button>
                    `;
                } else {
                    actionBtns = `
                        <button onclick="changeStatus(${item.id}, 'kho')" class="w-8 h-8 flex items-center justify-center rounded-full bg-slate-100 text-slate-500"><i class="fa-solid fa-box-open text-sm"></i></button>
                    `;
                }

                listEl.innerHTML += `
                    <div class="tg-card p-3 flex gap-3">
                        <div class="pt-1"><input type="checkbox" class="custom-checkbox" onchange="toggleCheckbox(${item.id})" ${item.checked ? 'checked' : ''}></div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start gap-1.5">
                                <h3 class="font-bold text-[15px] leading-tight ${textClass} break-words">${item.name}</h3>
                                <span class="text-[10px] bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded font-bold shrink-0 mt-0.5">x${item.qty}</span>
                            </div>
                            
                            ${item.price > 0 ? `<div class="text-[12px] font-bold text-blue-600 mt-0.5">${formatMoney(item.price)} ƒë <span class="text-[10px] text-slate-400 font-normal">/m√≥n</span></div>` : ''}
                            
                            ${item.note ? `<p class="text-[12px] text-slate-500 mt-1 leading-snug italic">${item.note}</p>` : ''}
                            
                            <div class="flex flex-wrap gap-1.5 mt-2">
                                <span class="text-[9px] uppercase font-bold px-1.5 py-0.5 rounded border border-slate-200 text-slate-600">${item.category}</span>
                            </div>

                            <div class="border-t border-dashed border-slate-200 my-2"></div>
                            <div class="flex items-center gap-1">
                                <i class="fa-solid fa-plane-departure text-[10px] text-slate-400"></i>
                                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded ${aviaColor}">${item.aviation}</span>
                            </div>
                            ${warningHtml}
                        </div>

                        <div class="flex flex-col gap-2 justify-center pl-2 border-l border-slate-100 shrink-0">
                            ${actionBtns}
                            <button onclick="openEditModal(${item.id})" class="w-8 h-8 flex items-center justify-center rounded-full text-slate-400 hover:text-blue-500 hover:bg-blue-50"><i class="fa-solid fa-pen text-xs"></i></button>
                            <button onclick="deleteItem(${item.id})" class="w-8 h-8 flex items-center justify-center rounded-full text-slate-400 hover:text-red-500 hover:bg-red-50"><i class="fa-solid fa-xmark text-lg"></i></button>
                        </div>
                    </div>
                `;
            });
            updateSidebarTags();
        }

        // M·ªü form Th√™m m·ªõi
        function openAddModal() {
            editingId = null;
            document.getElementById('modalTitle').innerText = "Th√™m ƒë·ªì m·ªõi";
            document.getElementById('submitBtn').innerText = "Th√™m v√†o kho";
            document.getElementById('itemName').value = '';
            document.getElementById('itemQty').value = '1';
            document.getElementById('itemPrice').value = '';
            document.getElementById('addModal').classList.remove('hidden');
        }

        // M·ªü form S·ª≠a
        function openEditModal(id) {
            editingId = id;
            let item = items.find(i => i.id === id);
            document.getElementById('modalTitle').innerText = "S·ª≠a th√¥ng tin";
            document.getElementById('submitBtn').innerText = "L∆∞u thay ƒë·ªïi";
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemQty').value = item.qty;
            document.getElementById('itemPrice').value = item.price > 0 ? formatMoney(item.price) : '';
            document.getElementById('addModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('addModal').classList.add('hidden');
        }

        // L∆∞u / S·ª≠a D·ªØ li·ªáu
        function saveItem() {
            let name = document.getElementById('itemName').value.trim();
            let qty = document.getElementById('itemQty').value || 1;
            let priceStr = document.getElementById('itemPrice').value.replace(/,/g, '');
            let price = priceStr ? Number(priceStr) : 0;
            
            if(!name) return;

            let autoData = autoCategorize(name);

            if (editingId) {
                // S·ª≠a ƒë·ªì
                let itemIndex = items.findIndex(i => i.id === editingId);
                if(itemIndex > -1) {
                    items[itemIndex].name = name;
                    items[itemIndex].qty = Number(qty);
                    items[itemIndex].price = price;
                    // C·∫≠p nh·∫≠t l·∫°i tag/c·∫£nh b√°o l·ª° ng∆∞·ªùi d√πng g√µ nh·∫ßm t√™n s·ª≠a l·∫°i
                    items[itemIndex].category = autoData.category;
                    items[itemIndex].aviation = autoData.aviation;
                    items[itemIndex].note = autoData.note;
                    items[itemIndex].warning = autoData.warning;
                }
            } else {
                // Th√™m m·ªõi
                items.unshift({
                    id: Date.now(),
                    name: name,
                    qty: Number(qty),
                    price: price,
                    category: autoData.category,
                    aviation: autoData.aviation,
                    note: autoData.note,
                    status: 'kho',
                    warning: autoData.warning,
                    checked: false
                });
            }

            saveToStorage();
            closeModal();
            renderItems();
        }

        function updateSidebarTags() {
            const listEl = document.getElementById('sidebarTagList');
            const lazadaCats = ["D√†nh ri√™ng cho b·∫°n", "Thi·∫øt B·ªã ƒêi·ªán T·ª≠", "Ph·ª• Ki·ªán ƒêi·ªán T·ª≠", "S·ª©c Kh·ªèe & L√†m ƒê·∫πp", "Si√™u Th·ªã T·∫°p H√≥a", "H√†ng Gia d·ª•ng & ƒê·ªùi s·ªëng", "Th·ªùi trang & Ph·ª• ki·ªán Nam", "Th·ªùi trang & Ph·ª• ki·ªán N·ªØ", "Th·ªÉ Thao & Du L·ªãch"];
            
            listEl.innerHTML = `<button onclick="filterByTag('')" class="text-left px-3 py-2.5 rounded-lg ${currentFilterTag === '' ? 'bg-blue-50 text-blue-600 font-bold' : 'bg-slate-50 text-slate-700 font-medium'} text-sm">Hi·ªÉn th·ªã t·∫•t c·∫£</button>`;
            
            lazadaCats.forEach(tag => {
                let activeClass = currentFilterTag === tag ? 'bg-blue-50 text-blue-600 font-bold' : 'text-slate-600 hover:bg-slate-50';
                listEl.innerHTML += `<button onclick="filterByTag('${tag}')" class="text-left px-3 py-2.5 rounded-lg text-sm font-medium ${activeClass}">${tag}</button>`;
            });
        }

        function filterByTag(tag) { currentFilterTag = tag; toggleSidebar(); renderItems(); }

        const sidebar = document.getElementById('sidebarOverlay');
        const sidebarContent = document.getElementById('sidebarContent');
        function toggleSidebar() {
            if(sidebar.classList.contains('hidden')) {
                sidebar.classList.remove('hidden');
                setTimeout(() => sidebarContent.classList.remove('-translate-x-full'), 10);
            } else {
                sidebarContent.classList.add('-translate-x-full');
                setTimeout(() => sidebar.classList.add('hidden'), 300);
            }
        }

        document.getElementById('searchInput').addEventListener('input', (e) => renderItems(e.target.value));
        
        // Render l·∫ßn ƒë·∫ßu khi v√†o trang
        renderItems();
    </script>
</body>
</html>
