<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Packify Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Tối ưu hóa cho giao diện Mobile PWA */
        body {
            background-color: #f1f2f6; /* Nền xám nhạt chuẩn Telegram */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        /* Ẩn scrollbar nhưng vẫn cuộn được */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        
        .tg-card {
            background-color: #ffffff;
            border-radius: 18px; /* Bo góc mượt như Telegram 12.4.1 */
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: transform 0.1s ease;
        }
        .tg-card:active { transform: scale(0.98); }
        
        /* Checkbox custom */
        .custom-checkbox {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e1;
            border-radius: 50%;
            outline: none;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .custom-checkbox:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }
        .custom-checkbox:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }

        /* Bottom Nav Safe Area */
        .bottom-nav { padding-bottom: env(safe-area-inset-bottom, 0); }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <header class="bg-white px-4 pt-6 pb-3 shadow-sm z-10 sticky top-0 flex flex-col gap-3">
        <div class="flex justify-between items-center">
            <button class="text-slate-600 text-xl w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100">
                <i class="fa-solid fa-bars"></i>
            </button>
            <h1 class="text-xl font-bold text-blue-600 tracking-tight">Packify Pro</h1>
            <button class="text-slate-600 text-xl w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100">
                <i class="fa-solid fa-ellipsis-vertical"></i>
            </button>
        </div>
        
        <div class="relative">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400"></i>
            <input type="text" id="searchInput" placeholder="Tìm kiếm nhanh..." 
                   class="w-full bg-slate-100 text-slate-700 rounded-full py-2.5 pl-11 pr-4 focus:outline-none focus:ring-2 focus:ring-blue-100 transition-all">
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 pb-24" id="mainContent">
        <div class="flex justify-between items-center mb-4 px-1">
            <h2 class="text-lg font-bold" id="currentCategoryTitle">Kho: <span id="totalItems" class="text-blue-500">0</span> items</h2>
            <div class="flex items-center gap-2">
                <label class="text-sm text-slate-500 font-medium">Chọn tất cả</label>
                <input type="checkbox" id="selectAll" class="custom-checkbox h-5 w-5">
            </div>
        </div>

        <div id="itemList" class="flex flex-col gap-3">
            </div>
    </main>

    <button onclick="toggleAddModal()" class="fixed bottom-20 right-5 w-14 h-14 bg-blue-500 text-white rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-blue-600 transition-transform hover:scale-105 z-20">
        <i class="fa-solid fa-plus"></i>
    </button>

    <nav class="bg-white border-t border-slate-200 flex justify-around items-center h-16 bottom-nav fixed bottom-0 w-full z-10">
        <button onclick="switchTab('kho')" id="tab-kho" class="flex flex-col items-center justify-center w-full h-full text-blue-500 transition-colors">
            <i class="fa-solid fa-box text-xl mb-1"></i>
            <span class="text-[10px] font-semibold">Kho Toàn Cầu</span>
        </button>
        <button onclick="switchTab('dangmua')" id="tab-dangmua" class="flex flex-col items-center justify-center w-full h-full text-slate-400 transition-colors">
            <i class="fa-solid fa-cart-shopping text-xl mb-1"></i>
            <span class="text-[10px] font-semibold">Đang Mua</span>
        </button>
        <button onclick="switchTab('vali')" id="tab-vali" class="flex flex-col items-center justify-center w-full h-full text-slate-400 transition-colors">
            <i class="fa-solid fa-suitcase-rolling text-xl mb-1"></i>
            <span class="text-[10px] font-semibold">Vali Của Tôi</span>
        </button>
    </nav>

    <div id="addModal" class="fixed inset-0 bg-black bg-opacity-40 z-50 hidden flex items-end justify-center transition-opacity">
        <div class="bg-white w-full rounded-t-3xl p-5 transform transition-transform translate-y-full" id="modalContent">
            <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-5"></div>
            <h3 class="text-xl font-bold mb-4">Thêm đồ mới</h3>
            <input type="text" id="itemName" placeholder="Tên món đồ (VD: Hộ chiếu, Thuốc, Áo khoác...)" class="w-full bg-slate-100 rounded-xl p-3 mb-3 focus:outline-none focus:ring-2 focus:ring-blue-200">
            <div class="flex gap-3 mb-5">
                <input type="number" id="itemQty" placeholder="Số lượng" value="1" class="w-1/3 bg-slate-100 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-blue-200">
            </div>
            <button onclick="addItem()" class="w-full bg-blue-500 text-white font-bold py-3 rounded-xl hover:bg-blue-600 transition-colors">
                Thêm vào danh sách
            </button>
        </div>
    </div>

    <script>
        // Data mẫu (Có thể dùng LocalStorage để lưu vĩnh viễn)
        let items = [
            { id: 1, name: "App Alipay & WeChat", qty: 1, category: "Digital", tags: ["Tài chính", "Bắt buộc"], note: "Tải và xác minh bằng Hộ chiếu.", status: "vali", warning: "" },
            { id: 2, name: "Backup Script Tampermonkey", qty: 1, category: "Code", tags: ["Backup"], note: "Export code lên Drive.", status: "kho", warning: "" }
        ];
        let currentTab = 'kho';

        // TỪ ĐIỂN THÔNG MINH: Tự động phân loại dựa vào từ khóa
        const autoDict = [
            { keywords: ["hộ chiếu", "visa", "jw202", "dq", "giấy tờ", "ảnh thẻ"], category: "Giấy tờ", tags: ["Quan trọng", "Bắt buộc"], note: "Kiểm tra kỹ trước khi đi!", warning: "Tuyệt đối không được quên món này ra sân bay!" },
            { keywords: ["vpn", "wechat", "alipay", "tampermonkey", "code", "bách hợp", "abo", "điện thoại", "sạc", "laptop"], category: "Digital", tags: ["Công nghệ", "Giải trí"], note: "Setup kỹ dùng offline/bên mạng Trung.", warning: "" },
            { keywords: ["thuốc", "đau bụng", "cảm", "băng gạc"], category: "Y tế", tags: ["Sức khỏe"], note: "Mang theo phòng hờ.", warning: "Lưu ý hạn sử dụng." },
            { keywords: ["quần", "áo", "tất", "giày", "váy"], category: "Trang phục", tags: ["Hành lý"], note: "Gấp gọn tiết kiệm diện tích.", warning: "" }
        ];

        // Logic tự động nhận diện
        function autoCategorize(name) {
            let lowerName = name.toLowerCase();
            for (let dict of autoDict) {
                if (dict.keywords.some(kw => lowerName.includes(kw))) {
                    return { category: dict.category, tags: dict.tags, note: dict.note, warning: dict.warning };
                }
            }
            return { category: "Khác", tags: ["Chung"], note: "", warning: "" };
        }

        // Đổi Tab
        function switchTab(tab) {
            currentTab = tab;
            ['kho', 'dangmua', 'vali'].forEach(t => {
                let el = document.getElementById(`tab-${t}`);
                if(t === tab) {
                    el.classList.replace('text-slate-400', 'text-blue-500');
                } else {
                    el.classList.replace('text-blue-500', 'text-slate-400');
                }
            });
            let title = tab === 'kho' ? 'Kho Toàn Cầu' : (tab === 'dangmua' ? 'Đang Mua' : 'Vali Của Tôi');
            document.getElementById('currentCategoryTitle').innerHTML = `${title}: <span id="totalItems" class="text-blue-500">0</span> items`;
            renderItems();
        }

        // Render giao diện Item (Style thẻ bo góc xịn)
        function renderItems(filterText = "") {
            const listEl = document.getElementById('itemList');
            listEl.innerHTML = '';
            
            let filteredItems = items.filter(i => i.status === currentTab);
            if(filterText) {
                filteredItems = filteredItems.filter(i => i.name.toLowerCase().includes(filterText.toLowerCase()));
            }

            document.getElementById('totalItems').innerText = filteredItems.length;

            filteredItems.forEach(item => {
                let badgeColors = item.tags.includes("Quan trọng") || item.tags.includes("Bắt buộc") 
                                ? "bg-red-100 text-red-600" 
                                : "bg-emerald-100 text-emerald-700";
                
                let warningHtml = item.warning ? `<div class="mt-2 text-xs text-red-500 flex items-center gap-1 bg-red-50 p-2 rounded-lg"><i class="fa-solid fa-triangle-exclamation"></i> ${item.warning}</div>` : '';

                let statusBtn = '';
                if(currentTab === 'kho') {
                    statusBtn = `
                        <button onclick="changeStatus(${item.id}, 'dangmua')" class="text-xs bg-orange-100 text-orange-600 px-3 py-1.5 rounded-lg font-bold hover:bg-orange-200">Mua</button>
                        <button onclick="changeStatus(${item.id}, 'vali')" class="text-xs bg-blue-100 text-blue-600 px-3 py-1.5 rounded-lg font-bold hover:bg-blue-200">Cất Vali</button>
                    `;
                } else if(currentTab === 'dangmua') {
                    statusBtn = `
                        <button onclick="changeStatus(${item.id}, 'kho')" class="text-xs bg-slate-100 text-slate-600 px-3 py-1.5 rounded-lg font-bold">Hủy</button>
                        <button onclick="changeStatus(${item.id}, 'vali')" class="text-xs bg-green-100 text-green-600 px-3 py-1.5 rounded-lg font-bold">Đã Mua & Cất</button>
                    `;
                } else {
                    statusBtn = `<button onclick="changeStatus(${item.id}, 'kho')" class="text-xs bg-red-100 text-red-600 px-3 py-1.5 rounded-lg font-bold hover:bg-red-200"><i class="fa-solid fa-minus"></i> Bỏ ra</button>`;
                }

                listEl.innerHTML += `
                    <div class="tg-card p-4 flex gap-3 items-start cursor-pointer" onclick="checkWarning('${item.warning}')">
                        <div class="pt-1">
                            <input type="checkbox" class="custom-checkbox">
                        </div>
                        <div class="flex-1">
                            <h3 class="font-bold text-slate-800 text-[15px] leading-tight flex items-center gap-2">
                                ${item.name} <span class="text-xs bg-slate-100 text-slate-500 px-2 py-0.5 rounded-md">x${item.qty}</span>
                            </h3>
                            ${item.note ? `<p class="text-[13px] text-slate-500 mt-1 leading-snug">${item.note}</p>` : ''}
                            <div class="flex flex-wrap gap-1.5 mt-2">
                                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded ${badgeColors}">${item.tags[0] || item.category}</span>
                                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded bg-blue-50 text-blue-600">${item.category}</span>
                            </div>
                            ${warningHtml}
                            <div class="flex gap-2 mt-3 pt-3 border-t border-slate-100">
                                ${statusBtn}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Xử lý thêm đồ
        function addItem() {
            let name = document.getElementById('itemName').value;
            let qty = document.getElementById('itemQty').value || 1;
            if(!name) return;

            // Chạy AI "chạy bằng cơm" tự động phân loại
            let autoData = autoCategorize(name);

            items.push({
                id: Date.now(),
                name: name,
                qty: qty,
                category: autoData.category,
                tags: autoData.tags,
                note: autoData.note,
                status: 'kho',
                warning: autoData.warning
            });

            document.getElementById('itemName').value = '';
            toggleAddModal();
            switchTab('kho'); // Chuyển về kho để thấy đồ vừa thêm
        }

        // Cảnh báo khi tick vào đồ có warning
        function checkWarning(warningMsg) {
            if(warningMsg && warningMsg !== 'undefined') {
                // Tích hợp rung (nếu mobile hỗ trợ)
                if (navigator.vibrate) navigator.vibrate(200);
                alert("⚠️ CHÚ Ý: " + warningMsg);
            }
        }

        // Chuyển trạng thái
        function changeStatus(id, newStatus) {
            event.stopPropagation(); // Tránh click nhầm vào card
            let itemIndex = items.findIndex(i => i.id === id);
            if(itemIndex > -1) {
                items[itemIndex].status = newStatus;
                renderItems();
            }
        }

        // Modal UX
        const modal = document.getElementById('addModal');
        const modalContent = document.getElementById('modalContent');
        function toggleAddModal() {
            if(modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => { modalContent.classList.remove('translate-y-full'); }, 10);
            } else {
                modalContent.classList.add('translate-y-full');
                setTimeout(() => { modal.classList.add('hidden'); }, 300);
            }
        }
        modal.addEventListener('click', (e) => {
            if(e.target === modal) toggleAddModal();
        });

        // Tìm kiếm
        document.getElementById('searchInput').addEventListener('input', (e) => {
            renderItems(e.target.value);
        });

        // Init
        renderItems();
    </script>
</body>
</html>
