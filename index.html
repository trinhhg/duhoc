<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Fetch Packing App</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        :root { --bg: #f8fafc; --surface: #ffffff; --primary: #0ea5e9; --text-main: #0f172a; --border: #e2e8f0; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        header { background: var(--surface); padding: 15px 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .logo { font-size: 1.2rem; font-weight: 700; color: var(--primary); }
        .search-box { width: 300px; padding: 10px 15px; border: 1px solid var(--border); border-radius: 8px; outline: none; }
        
        .app-container { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 250px; background: var(--surface); border-right: 1px solid var(--border); overflow-y: auto; padding: 15px 0; }
        .cat-item { padding: 12px 20px; cursor: pointer; font-size: 0.95rem; font-weight: 500; color: #64748b; text-transform: capitalize; border-left: 3px solid transparent; }
        .cat-item:hover { background: #f1f5f9; color: var(--text-main); }
        .cat-item.active { border-left-color: var(--primary); background: #f0f9ff; color: var(--primary); font-weight: 600; }

        .main-content { flex: 1; overflow-y: auto; padding: 20px; background: var(--bg); position: relative; }
        .loader { display: none; text-align: center; margin-top: 50px; font-weight: bold; color: var(--primary); }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 15px; display: flex; flex-direction: column; position: relative; }
        .card img { width: 100%; height: 120px; object-fit: contain; margin-bottom: 10px; border-radius: 6px; background: #f8fafc; }
        .item-name { font-size: 1.05rem; font-weight: 600; margin-bottom: 5px; padding-right: 30px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        
        .tags { display: flex; flex-wrap: wrap; gap: 5px; margin: 10px 0; }
        .tag { font-size: 0.7rem; padding: 3px 8px; border-radius: 12px; font-weight: 600; }
        .tag-balo { background: #e0e7ff; color: #3730a3; } 
        .tag-vali { background: #f3e8ff; color: #6b21a8; } 
        .tag-liquid { background: #e0f2fe; color: #0369a1; } 
        .tag-food { background: #dcfce7; color: #15803d; }

        .btn-add { position: absolute; top: 15px; right: 15px; width: 32px; height: 32px; border-radius: 8px; border: none; background: #f1f5f9; color: var(--primary); font-size: 1.2rem; cursor: pointer; font-weight: bold; }
        .btn-add:hover { background: var(--primary); color: white; }
        .btn-add.added { background: #10b981; color: white; }
    </style>
</head>
<body>

    <header>
        <div class="logo">‚ö° Auto-Fetch Packing</div>
        <input type="text" class="search-box" id="search" placeholder="T√¨m ƒë·ªì (VD: iphone, cream)..." onkeyup="filterItems()">
        <div style="font-weight: 600;">Vali: <span id="cart-count" style="color: var(--primary);">0</span> m√≥n</div>
    </header>

    <div class="app-container">
        <div class="sidebar" id="sidebar">
            </div>

        <div class="main-content">
            <h2 id="cat-title" style="margin-bottom: 20px; text-transform: capitalize;">T·∫•t c·∫£ ƒë·ªì v·∫≠t</h2>
            <div id="loader" class="loader">ƒêang t·ª± ƒë·ªông k√©o API data v·ªÅ... ‚è≥</div>
            <div class="grid" id="grid">
                </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://dummyjson.com/products?limit=100'; // Ngu·ªìn data t·ª± ƒë·ªông free
        let rawData = [];
        let categories = [];
        let currentCat = 'All';
        let myChecklist = JSON.parse(localStorage.getItem('auto_packing_list')) || [];

        // H√ÄM MIDDLEWARE: T·ª± ƒë·ªông ph√¢n t√≠ch API v√† g√°n Tag h√†nh l√Ω
        function autoGenerateTags(category) {
            let tags = [];
            switch(category) {
                case 'smartphones':
                case 'laptops':
                    tags.push({ text: 'X√°ch tay b·∫Øt bu·ªôc', class: 'tag-balo' });
                    tags.push({ text: 'ƒêi·ªán t·ª≠', class: 'tag-balo' });
                    break;
                case 'skincare':
                case 'fragrances':
                    tags.push({ text: 'Ch·∫•t l·ªèng', class: 'tag-liquid' });
                    tags.push({ text: 'K√Ω g·ª≠i Vali 24', class: 'tag-vali' });
                    break;
                case 'groceries':
                    tags.push({ text: 'ƒê·ªì ƒÉn', class: 'tag-food' });
                    tags.push({ text: 'K√Ω g·ª≠i Vali 24', class: 'tag-vali' });
                    break;
                case 'womens-dresses':
                case 'mens-shirts':
                case 'womens-shoes':
                    tags.push({ text: 'Qu·∫ßn √°o & Gi√†y', class: 'tag-vali' });
                    tags.push({ text: 'Vali 28', class: 'tag-vali' });
                    break;
                default:
                    tags.push({ text: 'T√πy ch·ªçn', class: 'tag-vali' });
            }
            return tags;
        }

        async function fetchAutoData() {
            document.getElementById('loader').style.display = 'block';
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                // Chu·∫©n h√≥a data t·ª´ API
                rawData = data.products.map(p => ({
                    id: p.id,
                    name: p.title,
                    category: p.category,
                    image: p.thumbnail,
                    tags: autoGenerateTags(p.category) // T·ª± ƒë·ªông g·∫Øn tag
                }));

                // T·ª± ƒë·ªông r√∫t tr√≠ch danh m·ª•c t·ª´ API
                categories = ['All', ...new Set(rawData.map(p => p.category))];
                
                document.getElementById('loader').style.display = 'none';
                renderSidebar();
                renderGrid();
                updateCount();
            } catch (error) {
                document.getElementById('loader').innerText = 'L·ªói k√©o API. Ki·ªÉm tra m·∫°ng!';
            }
        }

        function renderSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.innerHTML = categories.map(cat => 
                `<div class="cat-item ${currentCat === cat ? 'active' : ''}" onclick="selectCat('${cat}')">
                    ${cat === 'All' ? 'üåç T·∫•t c·∫£ (100+ items)' : cat.replace('-', ' ')}
                </div>`
            ).join('');
        }

        function selectCat(cat) {
            currentCat = cat;
            document.getElementById('cat-title').innerText = cat === 'All' ? 'üåç T·∫•t c·∫£ ƒë·ªì v·∫≠t' : cat.replace('-', ' ');
            renderSidebar();
            renderGrid();
        }

        function filterItems() {
            currentCat = 'All';
            renderSidebar();
            renderGrid();
        }

        function renderGrid() {
            const grid = document.getElementById('grid');
            const search = document.getElementById('search').value.toLowerCase();
            
            const filtered = rawData.filter(i => {
                const matchCat = currentCat === 'All' || i.category === currentCat;
                const matchSearch = i.name.toLowerCase().includes(search);
                return matchCat && matchSearch;
            });

            grid.innerHTML = filtered.map(item => {
                const isAdded = myChecklist.includes(item.id);
                return `
                <div class="card">
                    <img src="${item.image}" alt="${item.name}" loading="lazy">
                    <div class="item-name">${item.name}</div>
                    <div class="tags">
                        ${item.tags.map(t => `<span class="tag ${t.class}">${t.text}</span>`).join('')}
                    </div>
                    <button class="btn-add ${isAdded ? 'added' : ''}" onclick="toggleItem(${item.id}, this)">
                        ${isAdded ? '‚úì' : '+'}
                    </button>
                </div>`;
            }).join('');
        }

        function toggleItem(id, btn) {
            if(!myChecklist.includes(id)) {
                myChecklist.push(id);
                btn.classList.add('added');
                btn.innerText = '‚úì';
            } else {
                myChecklist = myChecklist.filter(i => i !== id);
                btn.classList.remove('added');
                btn.innerText = '+';
            }
            localStorage.setItem('auto_packing_list', JSON.stringify(myChecklist));
            updateCount();
        }

        function updateCount() {
            document.getElementById('cart-count').innerText = myChecklist.length;
        }

        // K√≠ch ho·∫°t k√©o API ngay khi ch·∫°y code
        fetchAutoData();
    </script>
</body>
</html>
